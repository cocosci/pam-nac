import numpy as np
import numpy.ma as ma
import matplotlib.pyplot as plt
from matplotlib import cm
import librosa
import scipy


def acoustic_parameter_setup(sample_rate):
    """
    Description: set up global constants for each sample rate, such as critical band, absolute hearing threshold, etc.
                 The setting for 44100 Hz is derived from Fabien A. P. Petitcolas's implementation at 
                 https://www.petitcolas.net/fabien/software/mpeg/; the setting for 32000 Hz is based on the following 
                 reference.
    Reference: https://books.google.com/books?id=tb41_XyeF4MC&pg=PA607&lpg=PA607&dq=19982.
               81+frequency&source=bl&ots=W-PAtFj9K_&sig=ACfU3U3AUtD71CM_jo7UrGGPpMLeTknY
               qw&hl=en&sa=X&ved=2ahUKEwinkZ6-gafmAhURPa0KHZWrBOwQ6AEwAHoECAoQAQ#v=onepage&q&f=false

    """
    if sample_rate == 44100:
        CB = np.array(
            [1, 2, 3, 5, 6, 8, 9, 11, 13, 15, 17, 20, 23, 27, 32, 37, 45, 50, 55, 61, 68, 75, 81, 93, 106]) - 1
        C = np.array(
            [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001,
             0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001,
             -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001,
             -0.0001, -0.0, -0.0, -0.0, 0.0, 0.0, 0.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0002, 0.0002, 0.0002,
             0.0002, 0.0003, 0.0003, 0.0003, 0.0004, 0.0004, 0.0004, 0.0005, 0.0005, 0.0005, 0.0006, 0.0006, 0.0006,
             0.0007, 0.0007, 0.0007, 0.0008, 0.0008, 0.0008, 0.0009, 0.0009, 0.0009, 0.0009, 0.001, 0.001, 0.001, 0.001,
             0.001, 0.001, 0.001, 0.001, 0.001, -0.001, -0.0009, -0.0009, -0.0009, -0.0008, -0.0008, -0.0007, -0.0007,
             -0.0006, -0.0005, -0.0005, -0.0004, -0.0003, -0.0002, -0.0001, 0.0, 0.0001, 0.0003, 0.0004, 0.0005, 0.0007,
             0.0008, 0.001, 0.0011, 0.0013, 0.0014, 0.0016, 0.0018, 0.0019, 0.0021, 0.0023, 0.0025, 0.0026, 0.0028,
             0.003, 0.0031, 0.0033, 0.0035, 0.0036, 0.0038, 0.0039, 0.004, 0.0042, 0.0043, 0.0044, 0.0045, 0.0046,
             0.0046, 0.0047, 0.0047, 0.0047, 0.0048, 0.0047, 0.0047, 0.0046, 0.0046, 0.0045, 0.0044, 0.0042, 0.004,
             0.0039, 0.0036, 0.0034, 0.0031, -0.0028, -0.0025, -0.0022, -0.0018, -0.0014, -0.001, -0.0005, -0.0, 0.0005,
             0.001, 0.0016, 0.0022, 0.0028, 0.0034, 0.0041, 0.0048, 0.0055, 0.0062, 0.0069, 0.0077, 0.0085, 0.0093,
             0.0101, 0.0109, 0.0118, 0.0126, 0.0135, 0.0144, 0.0152, 0.0161, 0.017, 0.0179, 0.0188, 0.0196, 0.0205,
             0.0214, 0.0222, 0.0231, 0.0239, 0.0247, 0.0255, 0.0263, 0.0271, 0.0278, 0.0285, 0.0292, 0.0299, 0.0305,
             0.0311, 0.0317, 0.0322, 0.0328, 0.0332, 0.0337, 0.0341, 0.0344, 0.0347, 0.035, 0.0352, 0.0354, 0.0356,
             0.0357, 0.0358, 0.0358, -0.0358, -0.0357, -0.0356, -0.0354, -0.0352, -0.035, -0.0347, -0.0344, -0.0341,
             -0.0337, -0.0332, -0.0328, -0.0322, -0.0317, -0.0311, -0.0305, -0.0299, -0.0292, -0.0285, -0.0278, -0.0271,
             -0.0263, -0.0255, -0.0247, -0.0239, -0.0231, -0.0222, -0.0214, -0.0205, -0.0196, -0.0188, -0.0179, -0.017,
             -0.0161, -0.0152, -0.0144, -0.0135, -0.0126, -0.0118, -0.0109, -0.0101, -0.0093, -0.0085, -0.0077, -0.0069,
             -0.0062, -0.0055, -0.0048, -0.0041, -0.0034, -0.0028, -0.0022, -0.0016, -0.001, -0.0005, 0.0, 0.0005,
             0.001, 0.0014, 0.0018, 0.0022, 0.0025, 0.0028, 0.0031, -0.0034, -0.0036, -0.0039, -0.004, -0.0042, -0.0044,
             -0.0045, -0.0046, -0.0046, -0.0047, -0.0047, -0.0048, -0.0047, -0.0047, -0.0047, -0.0046, -0.0046, -0.0045,
             -0.0044, -0.0043, -0.0042, -0.004, -0.0039, -0.0038, -0.0036, -0.0035, -0.0033, -0.0031, -0.003, -0.0028,
             -0.0026, -0.0025, -0.0023, -0.0021, -0.0019, -0.0018, -0.0016, -0.0014, -0.0013, -0.0011, -0.001, -0.0008,
             -0.0007, -0.0005, -0.0004, -0.0003, -0.0001, -0.0, 0.0001, 0.0002, 0.0003, 0.0004, 0.0005, 0.0005, 0.0006,
             0.0007, 0.0007, 0.0008, 0.0008, 0.0009, 0.0009, 0.0009, 0.001, 0.001, -0.001, -0.001, -0.001, -0.001,
             -0.001, -0.001, -0.001, -0.001, -0.0009, -0.0009, -0.0009, -0.0009, -0.0008, -0.0008, -0.0008, -0.0007,
             -0.0007, -0.0007, -0.0006, -0.0006, -0.0006, -0.0005, -0.0005, -0.0005, -0.0004, -0.0004, -0.0004, -0.0003,
             -0.0003, -0.0003, -0.0002, -0.0002, -0.0002, -0.0002, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0,
             -0.0, -0.0, 0.0, 0.0, 0.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001,
             0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, -0.0001, -0.0001, -0.0001, -0.0001,
             -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0,
             -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0,
             -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0,
             -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0])
        TH = np.array(
            [1.0, 0.85, 13.87, 2.0, 1.694, 2.85, 3.0, 2.525, -1.28, 4.0, 3.337, -3.5, 5.0, 4.124, -4.9, 6.0, 4.882,
             -5.89, 7.0, 5.608, -6.63, 8.0, 6.301, -7.21, 9.0, 6.959, -7.68, 10.0, 7.581, -8.08, 11.0, 8.169, -8.43,
             12.0, 8.723, -8.75, 13.0, 9.244, -9.05, 14.0, 9.734, -9.33, 15.0, 10.195, -9.61, 16.0, 10.629, -9.89, 17.0,
             11.037, -10.17, 18.0, 11.421, -10.47, 19.0, 11.783, -10.77, 20.0, 12.125, -11.1, 21.0, 12.448, -11.44,
             22.0, 12.753, -11.79, 23.0, 13.042, -12.17, 24.0, 13.317, -12.56, 25.0, 13.577, -12.96, 26.0, 13.825,
             -13.38, 27.0, 14.062, -13.79, 28.0, 14.288, -14.21, 29.0, 14.504, -14.63, 30.0, 14.711, -15.03, 31.0,
             14.909, -15.41, 32.0, 15.1, -15.77, 33.0, 15.283, -16.09, 34.0, 15.46, -16.37, 35.0, 15.631, -16.6, 36.0,
             15.795, -16.78, 37.0, 15.955, -16.91, 38.0, 16.11, -16.97, 39.0, 16.26, -16.98, 40.0, 16.405, -16.92, 41.0,
             16.547, -16.81, 42.0, 16.685, -16.65, 43.0, 16.82, -16.43, 44.0, 16.951, -16.17, 45.0, 17.079, -15.87,
             46.0, 17.204, -15.54, 47.0, 17.327, -15.19, 48.0, 17.447, -14.82, 50.0, 17.68, -14.06, 52.0, 17.904,
             -13.32, 54.0, 18.121, -12.64, 56.0, 18.331, -12.04, 58.0, 18.534, -11.53, 60.0, 18.73, -11.11, 62.0,
             18.922, -10.77, 64.0, 19.108, -10.49, 66.0, 19.288, -10.26, 68.0, 19.464, -10.07, 70.0, 19.635, -9.89,
             72.0, 19.801, -9.72, 74.0, 19.963, -9.54, 76.0, 20.12, -9.37, 78.0, 20.273, -9.18, 80.0, 20.421, -8.97,
             82.0, 20.565, -8.75, 84.0, 20.705, -8.51, 86.0, 20.84, -8.26, 88.0, 20.971, -7.98, 90.0, 21.099, -7.68,
             92.0, 21.222, -7.36, 94.0, 21.341, -7.02, 96.0, 21.457, -6.65, 100.0, 21.676, -5.85, 104.0, 21.882, -4.93,
             108.0, 22.074, -3.9, 112.0, 22.253, -2.75, 116.0, 22.42, -1.46, 120.0, 22.575, -0.03, 124.0, 22.721, 1.56,
             128.0, 22.857, 3.31, 132.0, 22.984, 5.23, 136.0, 23.102, 7.34, 140.0, 23.213, 9.64, 144.0, 23.317, 12.15,
             148.0, 23.414, 14.88, 152.0, 23.506, 17.84, 156.0, 23.592, 21.05, 160.0, 23.673, 24.52, 164.0, 23.749,
             28.25, 168.0, 23.821, 32.27, 172.0, 23.888, 36.59, 176.0, 23.952, 41.22, 180.0, 24.013, 46.18, 184.0,
             24.07, 51.49, 188.0, 24.124, 56.0, 192.0, 24.176, 56.0, 196.0, 24.225, 56.0, 200.0, 24.271, 56.0, 204.0,
             24.316, 56.0, 208.0, 24.358, 56.0, 212.0, 24.398, 56.0, 216.0, 24.436, 56.0, 220.0, 24.473, 56.0, 224.0,
             24.508, 56.0, 228.0, 24.541, 56.0, 232.0, 24.573, 56.0])
        TH = np.reshape(TH, (106, 3))
        LTq = np.array(
            [13.87, 2.85, -1.28, -3.5, -4.9, -5.89, -6.63, -7.21, -7.68, -8.08, -8.43, -8.75, -9.05, -9.33, -9.61,
             -9.89, -10.17, -10.47, -10.77, -11.1, -11.44, -11.79, -12.17, -12.56, -12.96, -13.38, -13.79, -14.21,
             -14.63, -15.03, -15.41, -15.77, -16.09, -16.37, -16.6, -16.78, -16.91, -16.97, -16.98, -16.92, -16.81,
             -16.65, -16.43, -16.17, -15.87, -15.54, -15.19, -14.82, -14.06, -13.32, -12.64, -12.04, -11.53, -11.11,
             -10.77, -10.49, -10.26, -10.07, -9.89, -9.72, -9.54, -9.37, -9.18, -8.97, -8.75, -8.51, -8.26, -7.98,
             -7.68, -7.36, -7.02, -6.65, -5.85, -4.93, -3.9, -2.75, -1.46, -0.03, 1.56, 3.31, 5.23, 7.34, 9.64, 12.15,
             14.88, 17.84, 21.05, 24.52, 28.25, 32.27, 36.59, 41.22, 46.18, 51.49, 56.0, 56.0, 56.0, 56.0, 56.0, 56.0,
             56.0, 56.0, 56.0, 56.0, 56.0, 56.0])
        Map = np.array(
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
             30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 48, 49, 49, 50, 50, 51, 51, 52,
             52, 53, 53, 54, 54, 55, 55, 56, 56, 57, 57, 58, 58, 59, 59, 60, 60, 61, 61, 62, 62, 63, 63, 64, 64, 65, 65,
             66, 66, 67, 67, 68, 68, 69, 69, 70, 70, 71, 71, 72, 72, 72, 72, 73, 73, 73, 73, 74, 74, 74, 74, 75, 75, 75,
             75, 76, 76, 76, 76, 77, 77, 77, 77, 78, 78, 78, 78, 79, 79, 79, 79, 80, 80, 80, 80, 81, 81, 81, 81, 82, 82,
             82, 82, 83, 83, 83, 83, 84, 84, 84, 84, 85, 85, 85, 85, 86, 86, 86, 86, 87, 87, 87, 87, 88, 88, 88, 88, 89,
             89, 89, 89, 90, 90, 90, 90, 91, 91, 91, 91, 92, 92, 92, 92, 93, 93, 93, 93, 94, 94, 94, 94, 95, 95, 95, 95,
             96, 96, 96, 96, 97, 97, 97, 97, 98, 98, 98, 98, 99, 99, 99, 99, 100, 100, 100, 100, 101, 101, 101, 101,
             102, 102, 102, 102, 103, 103, 103, 103, 104, 104, 104, 104, 105, 105, 105, 105, 106, 106, 106, 106, 106,
             106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106, 106]) - 1
    else:
        CB = np.array(
            [1, 2, 3, 4, 6, 7, 8, 10, 11, 13, 15, 18, 21, 24, 29, 34, 41, 49, 53, 58, 65, 73, 79, 91, 102]) - 1
        C = np.array(
            [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
             0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001,
             0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001,
             -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001,
             -0.0001, -0.0, -0.0, -0.0, 0.0, 0.0, 0.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0002, 0.0002, 0.0002,
             0.0002, 0.0003, 0.0003, 0.0003, 0.0004, 0.0004, 0.0004, 0.0005, 0.0005, 0.0005, 0.0006, 0.0006, 0.0006,
             0.0007, 0.0007, 0.0007, 0.0008, 0.0008, 0.0008, 0.0009, 0.0009, 0.0009, 0.0009, 0.001, 0.001, 0.001, 0.001,
             0.001, 0.001, 0.001, 0.001, 0.001, -0.001, -0.0009, -0.0009, -0.0009, -0.0008, -0.0008, -0.0007, -0.0007,
             -0.0006, -0.0005, -0.0005, -0.0004, -0.0003, -0.0002, -0.0001, 0.0, 0.0001, 0.0003, 0.0004, 0.0005, 0.0007,
             0.0008, 0.001, 0.0011, 0.0013, 0.0014, 0.0016, 0.0018, 0.0019, 0.0021, 0.0023, 0.0025, 0.0026, 0.0028,
             0.003, 0.0031, 0.0033, 0.0035, 0.0036, 0.0038, 0.0039, 0.004, 0.0042, 0.0043, 0.0044, 0.0045, 0.0046,
             0.0046, 0.0047, 0.0047, 0.0047, 0.0048, 0.0047, 0.0047, 0.0046, 0.0046, 0.0045, 0.0044, 0.0042, 0.004,
             0.0039, 0.0036, 0.0034, 0.0031, -0.0028, -0.0025, -0.0022, -0.0018, -0.0014, -0.001, -0.0005, -0.0, 0.0005,
             0.001, 0.0016, 0.0022, 0.0028, 0.0034, 0.0041, 0.0048, 0.0055, 0.0062, 0.0069, 0.0077, 0.0085, 0.0093,
             0.0101, 0.0109, 0.0118, 0.0126, 0.0135, 0.0144, 0.0152, 0.0161, 0.017, 0.0179, 0.0188, 0.0196, 0.0205,
             0.0214, 0.0222, 0.0231, 0.0239, 0.0247, 0.0255, 0.0263, 0.0271, 0.0278, 0.0285, 0.0292, 0.0299, 0.0305,
             0.0311, 0.0317, 0.0322, 0.0328, 0.0332, 0.0337, 0.0341, 0.0344, 0.0347, 0.035, 0.0352, 0.0354, 0.0356,
             0.0357, 0.0358, 0.0358, -0.0358, -0.0357, -0.0356, -0.0354, -0.0352, -0.035, -0.0347, -0.0344, -0.0341,
             -0.0337, -0.0332, -0.0328, -0.0322, -0.0317, -0.0311, -0.0305, -0.0299, -0.0292, -0.0285, -0.0278, -0.0271,
             -0.0263, -0.0255, -0.0247, -0.0239, -0.0231, -0.0222, -0.0214, -0.0205, -0.0196, -0.0188, -0.0179, -0.017,
             -0.0161, -0.0152, -0.0144, -0.0135, -0.0126, -0.0118, -0.0109, -0.0101, -0.0093, -0.0085, -0.0077, -0.0069,
             -0.0062, -0.0055, -0.0048, -0.0041, -0.0034, -0.0028, -0.0022, -0.0016, -0.001, -0.0005, 0.0, 0.0005,
             0.001, 0.0014, 0.0018, 0.0022, 0.0025, 0.0028, 0.0031, -0.0034, -0.0036, -0.0039, -0.004, -0.0042, -0.0044,
             -0.0045, -0.0046, -0.0046, -0.0047, -0.0047, -0.0048, -0.0047, -0.0047, -0.0047, -0.0046, -0.0046, -0.0045,
             -0.0044, -0.0043, -0.0042, -0.004, -0.0039, -0.0038, -0.0036, -0.0035, -0.0033, -0.0031, -0.003, -0.0028,
             -0.0026, -0.0025, -0.0023, -0.0021, -0.0019, -0.0018, -0.0016, -0.0014, -0.0013, -0.0011, -0.001, -0.0008,
             -0.0007, -0.0005, -0.0004, -0.0003, -0.0001, -0.0, 0.0001, 0.0002, 0.0003, 0.0004, 0.0005, 0.0005, 0.0006,
             0.0007, 0.0007, 0.0008, 0.0008, 0.0009, 0.0009, 0.0009, 0.001, 0.001, -0.001, -0.001, -0.001, -0.001,
             -0.001, -0.001, -0.001, -0.001, -0.0009, -0.0009, -0.0009, -0.0009, -0.0008, -0.0008, -0.0008, -0.0007,
             -0.0007, -0.0007, -0.0006, -0.0006, -0.0006, -0.0005, -0.0005, -0.0005, -0.0004, -0.0004, -0.0004, -0.0003,
             -0.0003, -0.0003, -0.0002, -0.0002, -0.0002, -0.0002, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0,
             -0.0, -0.0, 0.0, 0.0, 0.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001,
             0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, 0.0001, -0.0001, -0.0001, -0.0001, -0.0001,
             -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0001, -0.0,
             -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0,
             -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0,
             -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, 0.0])
        TH = np.array(
            [2.0, 0.925, 24.17, 3.0, 1.842, 13.87, 5.0, 2.742, 10.01, 6.0, 3.618, 7.94, 8.0, 4.463, 6.62, 9.0, 5.272,
             5.7, 11.0, 6.041, 5.0, 12.0, 6.77, 4.45, 14.0, 7.457, 4.0, 15.0, 8.103, 3.61, 17.0, 8.708, 3.26, 18.0,
             9.275, 2.93, 20.0, 9.805, 2.63, 21.0, 10.301, 2.32, 23.0, 10.765, 2.02, 24.0, 11.199, 1.71, 26.0, 11.606,
             1.38, 27.0, 11.988, 1.04, 29.0, 12.347, 0.67, 30.0, 12.684, 0.29, 32.0, 13.002, -0.11, 33.0, 13.302, -0.54,
             35.0, 13.586, -0.97, 36.0, 13.855, -1.43, 38.0, 14.111, -1.89, 39.0, 14.354, -2.34, 41.0, 14.585, -2.79,
             42.0, 14.807, -3.22, 44.0, 15.018, -3.62, 45.0, 15.221, -3.98, 47.0, 15.415, -4.3, 48.0, 15.602, -4.57,
             50.0, 15.783, -4.77, 51.0, 15.956, -4.91, 53.0, 16.124, -4.98, 54.0, 16.287, -4.97, 56.0, 16.445, -4.9,
             57.0, 16.598, -4.76, 59.0, 16.746, -4.55, 60.0, 16.891, -4.29, 62.0, 17.032, -3.99, 63.0, 17.169, -3.64,
             65.0, 17.303, -3.26, 66.0, 17.434, -2.86, 68.0, 17.563, -2.45, 69.0, 17.688, -2.04, 71.0, 17.811, -1.63,
             72.0, 17.932, -1.24, 75.0, 18.166, -0.51, 78.0, 18.392, 0.12, 81.0, 18.611, 0.64, 84.0, 18.823, 1.06, 87.0,
             19.028, 1.39, 90.0, 19.226, 1.66, 93.0, 19.419, 1.88, 96.0, 19.606, 2.08, 99.0, 19.788, 2.27, 102.0,
             19.964, 2.46, 105.0, 20.135, 2.65, 108.0, 20.3, 2.86, 111.0, 20.461, 3.09, 114.0, 20.616, 3.33, 117.0,
             20.766, 3.6, 120.0, 20.912, 3.89, 123.0, 21.052, 4.2, 126.0, 21.188, 4.54, 129.0, 21.318, 4.91, 132.0,
             21.445, 5.31, 135.0, 21.567, 5.73, 138.0, 21.684, 6.18, 141.0, 21.797, 6.67, 144.0, 21.906, 7.19, 150.0,
             22.113, 8.33, 156.0, 22.304, 9.63, 162.0, 22.482, 11.08, 168.0, 22.646, 12.71, 174.0, 22.799, 14.53, 180.0,
             22.941, 16.54, 186.0, 23.072, 18.77, 192.0, 23.195, 21.23, 198.0, 23.309, 23.94, 204.0, 23.415, 26.9,
             210.0, 23.515, 30.14, 216.0, 23.607, 33.67, 222.0, 23.694, 37.51, 228.0, 23.775, 41.67, 234.0, 23.852,
             46.17, 240.0, 23.923, 51.04, 246.0, 23.991, 56.29, 252.0, 24.054, 61.94, 258.0, 24.114, 68.0, 264.0,
             24.171, 68.0, 270.0, 24.224, 68.0, 276.0, 24.275, 68.0, 282.0, 24.322, 68.0, 288.0, 24.368, 68.0, 294.0,
             24.411, 68.0, 300.0, 24.452, 68.0, 306.0, 24.491, 68.0, 312.0, 24.528, 68.0, 318.0, 24.564, 68.0, 324.0,
             24.597, 68.0])
        TH = np.reshape(TH, (102, 3))
        LTq = np.array(
            [24.17, 13.87, 10.01, 7.94, 6.62, 5.7, 5.0, 4.45, 4.0, 3.61, 3.26, 2.93, 2.63, 2.32, 2.02, 1.71, 1.38, 1.04,
             0.67, 0.29, -0.11, -0.54, -0.97, -1.43, -1.89, -2.34, -2.79, -3.22, -3.62, -3.98, -4.3, -4.57, -4.77,
             -4.91, -4.98, -4.97, -4.9, -4.76, -4.55, -4.29, -3.99, -3.64, -3.26, -2.86, -2.45, -2.04, -1.63, -1.24,
             -0.51, 0.12, 0.64, 1.06, 1.39, 1.66, 1.88, 2.08, 2.27, 2.46, 2.65, 2.86, 3.09, 3.33, 3.6, 3.89, 4.2, 4.54,
             4.91, 5.31, 5.73, 6.18, 6.67, 7.19, 8.33, 9.63, 11.08, 12.71, 14.53, 16.54, 18.77, 21.23, 23.94, 26.9,
             30.14, 33.67, 37.51, 41.67, 46.17, 51.04, 56.29, 61.94, 68.0, 68.0, 68.0, 68.0, 68.0, 68.0, 68.0, 68.0,
             68.0, 68.0, 68.0, 68.0])
        Map = np.array(
            [1, 1, 2, 2, 3, 4, 4, 5, 6, 6, 7, 8, 8, 9, 10, 10, 11, 12, 12, 13, 14, 14, 15, 16, 16, 17, 18, 18, 19, 20,
             20, 21, 22, 22, 23, 24, 24, 25, 26, 26, 27, 28, 28, 29, 30, 30, 31, 32, 32, 33, 34, 34, 35, 36, 36, 37, 38,
             38, 39, 40, 40, 41, 42, 42, 43, 44, 44, 45, 46, 46, 47, 48, 48, 48, 49, 49, 49, 50, 50, 50, 51, 51, 51, 52,
             52, 52, 53, 53, 53, 54, 54, 54, 55, 55, 55, 56, 56, 56, 57, 57, 57, 58, 58, 58, 59, 59, 59, 60, 60, 60, 61,
             61, 61, 62, 62, 62, 63, 63, 63, 64, 64, 64, 65, 65, 65, 66, 66, 66, 67, 67, 67, 68, 68, 68, 69, 69, 69, 70,
             70, 70, 71, 71, 71, 72, 72, 72, 72, 72, 72, 73, 73, 73, 73, 73, 73, 74, 74, 74, 74, 74, 74, 75, 75, 75, 75,
             75, 75, 76, 76, 76, 76, 76, 76, 77, 77, 77, 77, 77, 77, 78, 78, 78, 78, 78, 78, 79, 79, 79, 79, 79, 79, 80,
             80, 80, 80, 80, 80, 81, 81, 81, 81, 81, 81, 82, 82, 82, 82, 82, 82, 83, 83, 83, 83, 83, 83, 84, 84, 84, 84,
             84, 84, 85, 85, 85, 85, 85, 85, 86, 86, 86, 86, 86, 86, 87, 87, 87, 87, 87, 87, 88, 88, 88, 88, 88, 88, 89,
             89, 89, 89, 89, 89, 90, 90, 90, 90, 90, 90, 91, 91, 91, 91, 91, 91, 92, 92, 92, 92, 92, 92, 93, 93, 93, 93,
             93, 93, 94, 94, 94, 94, 94, 94, 95, 95, 95, 95, 95, 95, 96, 96, 96, 96, 96, 96, 97, 97, 97, 97, 97, 97, 98,
             98, 98, 98, 98, 98, 99, 99, 99, 99, 99, 99, 100, 100, 100, 100, 100, 100, 101, 101, 101, 101, 101,
             101]) - 1
    return CB, C, TH, LTq, Map

CB, C, TH, LTq, Map = acoustic_parameter_setup(44100)
TH[:, 0] = TH[:, 0] - 1

FFT_SIZE = 512

# Flags for tonal analysis
NOT_EXAMINED = 0
TONAL = 1
NON_TONAL = 2
IRRELEVANT = 3
MIN_POWER = -200

# Set to one to see the graphs and explanation text
DRAW = 1

# Indices used in tables like the threshold table
# or in the list of tonal and non-tonal components.
INDEX = 0
BARK = 1
SPL = 1
ATH = 2

# Power normalization term
PN = 90.302  

hann_func = np.array(
    [0, 0.0001, 0.0002, 0.0006, 0.001, 0.0015, 0.0022, 0.003, 0.0039, 0.005, 0.0061, 0.0074, 0.0088, 0.0104, 0.012,
     0.0138, 0.0157, 0.0177, 0.0198, 0.0221, 0.0245, 0.027, 0.0296, 0.0323, 0.0352, 0.0381, 0.0412, 0.0444, 0.0477,
     0.0512, 0.0547, 0.0584, 0.0622, 0.066, 0.07, 0.0742, 0.0784, 0.0827, 0.0872, 0.0917, 0.0964, 0.1012, 0.1061,
     0.1111, 0.1162, 0.1214, 0.1267, 0.1321, 0.1376, 0.1432, 0.1489, 0.1548, 0.1607, 0.1667, 0.1728, 0.179, 0.1853,
     0.1917, 0.1982, 0.2048, 0.2115, 0.2183, 0.2252, 0.2321, 0.2391, 0.2463, 0.2535, 0.2608, 0.2682, 0.2756, 0.2832,
     0.2908, 0.2985, 0.3063, 0.3142, 0.3221, 0.3301, 0.3382, 0.3464, 0.3546, 0.3629, 0.3712, 0.3797, 0.3882, 0.3967,
     0.4054, 0.414, 0.4228, 0.4316, 0.4405, 0.4494, 0.4584, 0.4674, 0.4765, 0.4856, 0.4948, 0.504, 0.5133, 0.5226,
     0.532, 0.5414, 0.5509, 0.5604, 0.5699, 0.5795, 0.5891, 0.5987, 0.6084, 0.6181, 0.6278, 0.6376, 0.6474, 0.6572,
     0.667, 0.6769, 0.6868, 0.6967, 0.7066, 0.7165, 0.7265, 0.7365, 0.7464, 0.7564, 0.7664, 0.7764, 0.7864, 0.7965,
     0.8065, 0.8165, 0.8265, 0.8365, 0.8465, 0.8566, 0.8666, 0.8766, 0.8865, 0.8965, 0.9065, 0.9164, 0.9264, 0.9363,
     0.9462, 0.9561, 0.9659, 0.9758, 0.9856, 0.9954, 1.0052, 1.0149, 1.0246, 1.0343, 1.0439, 1.0535, 1.0631, 1.0726,
     1.0821, 1.0916, 1.101, 1.1103, 1.1197, 1.129, 1.1382, 1.1474, 1.1565, 1.1656, 1.1746, 1.1836, 1.1925, 1.2014,
     1.2102, 1.2189, 1.2276, 1.2363, 1.2448, 1.2533, 1.2618, 1.2701, 1.2784, 1.2866, 1.2948, 1.3029, 1.3109, 1.3188,
     1.3267, 1.3345, 1.3422, 1.3498, 1.3574, 1.3648, 1.3722, 1.3795, 1.3867, 1.3938, 1.4009, 1.4078, 1.4147, 1.4215,
     1.4282, 1.4348, 1.4413, 1.4477, 1.454, 1.4602, 1.4663, 1.4723, 1.4782, 1.4841, 1.4898, 1.4954, 1.5009, 1.5063,
     1.5116, 1.5168, 1.5219, 1.5269, 1.5318, 1.5366, 1.5413, 1.5458, 1.5503, 1.5546, 1.5588, 1.5629, 1.5669, 1.5708,
     1.5746, 1.5783, 1.5818, 1.5853, 1.5886, 1.5918, 1.5949, 1.5978, 1.6007, 1.6034, 1.606, 1.6085, 1.6109, 1.6132,
     1.6153, 1.6173, 1.6192, 1.621, 1.6226, 1.6242, 1.6256, 1.6269, 1.628, 1.6291, 1.63, 1.6308, 1.6315, 1.632, 1.6324,
     1.6327, 1.6329, 1.633, 1.6329, 1.6327, 1.6324, 1.632, 1.6315, 1.6308, 1.63, 1.6291, 1.628, 1.6269, 1.6256, 1.6242,
     1.6226, 1.621, 1.6192, 1.6173, 1.6153, 1.6132, 1.6109, 1.6085, 1.606, 1.6034, 1.6007, 1.5978, 1.5949, 1.5918,
     1.5886, 1.5853, 1.5818, 1.5783, 1.5746, 1.5708, 1.5669, 1.5629, 1.5588, 1.5546, 1.5503, 1.5458, 1.5413, 1.5366,
     1.5318, 1.5269, 1.5219, 1.5168, 1.5116, 1.5063, 1.5009, 1.4954, 1.4898, 1.4841, 1.4782, 1.4723, 1.4663, 1.4602,
     1.454, 1.4477, 1.4413, 1.4348, 1.4282, 1.4215, 1.4147, 1.4078, 1.4009, 1.3938, 1.3867, 1.3795, 1.3722, 1.3648,
     1.3574, 1.3498, 1.3422, 1.3345, 1.3267, 1.3188, 1.3109, 1.3029, 1.2948, 1.2866, 1.2784, 1.2701, 1.2618, 1.2533,
     1.2448, 1.2363, 1.2276, 1.2189, 1.2102, 1.2014, 1.1925, 1.1836, 1.1746, 1.1656, 1.1565, 1.1474, 1.1382, 1.129,
     1.1197, 1.1103, 1.101, 1.0916, 1.0821, 1.0726, 1.0631, 1.0535, 1.0439, 1.0343, 1.0246, 1.0149, 1.0052, 0.9954,
     0.9856, 0.9758, 0.9659, 0.9561, 0.9462, 0.9363, 0.9264, 0.9164, 0.9065, 0.8965, 0.8865, 0.8766, 0.8666, 0.8566,
     0.8465, 0.8365, 0.8265, 0.8165, 0.8065, 0.7965, 0.7864, 0.7764, 0.7664, 0.7564, 0.7464, 0.7365, 0.7265, 0.7165,
     0.7066, 0.6967, 0.6868, 0.6769, 0.667, 0.6572, 0.6474, 0.6376, 0.6278, 0.6181, 0.6084, 0.5987, 0.5891, 0.5795,
     0.5699, 0.5604, 0.5509, 0.5414, 0.532, 0.5226, 0.5133, 0.504, 0.4948, 0.4856, 0.4765, 0.4674, 0.4584, 0.4494,
     0.4405, 0.4316, 0.4228, 0.414, 0.4054, 0.3967, 0.3882, 0.3797, 0.3712, 0.3629, 0.3546, 0.3464, 0.3382, 0.3301,
     0.3221, 0.3142, 0.3063, 0.2985, 0.2908, 0.2832, 0.2756, 0.2682, 0.2608, 0.2535, 0.2463, 0.2391, 0.2321, 0.2252,
     0.2183, 0.2115, 0.2048, 0.1982, 0.1917, 0.1853, 0.179, 0.1728, 0.1667, 0.1607, 0.1548, 0.1489, 0.1432, 0.1376,
     0.1321, 0.1267, 0.1214, 0.1162, 0.1111, 0.1061, 0.1012, 0.0964, 0.0917, 0.0872, 0.0827, 0.0784, 0.0742, 0.07,
     0.066, 0.0622, 0.0584, 0.0547, 0.0512, 0.0477, 0.0444, 0.0412, 0.0381, 0.0352, 0.0323, 0.0296, 0.027, 0.0245,
     0.0221, 0.0198, 0.0177, 0.0157, 0.0138, 0.012, 0.0104, 0.0088, 0.0074, 0.0061, 0.005, 0.0039, 0.003, 0.0022,
     0.0015, 0.001, 0.0006, 0.0002, 0.0001])
